window.APPCONF={BAAS_APP_CODE:"1234567890",URLS:{SIGNUP:"http://baasbox-cog4.rhcloud.com/user",LOGIN:"http://baasbox-cog4.rhcloud.com/login",CHANGEPASS:"http://baasbox-cog4.rhcloud.com/me/password",LOGOUT:"http://baasbox-cog4.rhcloud.com/logout",RESETPASS:"http://baasbox-cog4.rhcloud.com/user/:username/password/reset"}},window.helpers={serializeFormToArray:function(a){var b={};return a.find("input[name], textarea[name]").each(function(a,c){var d=$(c);b[d.attr("name")]=d.val()}),b}},window.Paperapp={Models:{},models:{},Collections:{},collections:{},Views:{},views:{},init:function(){Paperapp.views.appView=new Paperapp.Views.AppView}},function(){var a,b,c,d;a=_.Deferred(),b=_.Deferred(),window.DocumentTouch&&document instanceof DocumentTouch||"ontouchstart"in window||(c=document.createElement("script"),c.src="bower_components/intel-appframework/plugins/af.desktopBrowsers.js",d=$("head").append(c),$.os.android=!0,$.os.desktop=!0,b.resolve()),$.ui.autoLaunch=!1,document.addEventListener("deviceready",b.resolve,!0),document.addEventListener("DOMContentLoaded",a.resolve,!1),_.when([b,a]).then(function(){window.Paperapp.init()})}(),this.JST=this.JST||{},this.JST["app/scripts/templates/app.hbs"]=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f="";return f}),this.JST["app/scripts/templates/settings.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(){return'\n	<a href="#changepass-page" class="button m-settings m-first" id="user-changepass" title="Login">Change password</a>\n	<a href="#" class="button m-settings" id="user-logout" title="Login">Logout</a>\n	\n'}function g(){return'\n	<a href="#login-page" class="button m-settings m-first" id="user-login" title="Login">Login</a>\n	<a href="#signup-page" class="button m-settings" id="user-signup" title="Signup">Signup</a>\n	<a href="#resetpass-page" class="button m-settings" id="user-resetpass" title="Login">Reset password</a>\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j=this;return i+='<input type="text" value="Search" class="search-field" />\n\n',h=c["if"].call(b,b.loggedIn,{hash:{},inverse:j.program(3,g,e),fn:j.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i}),Paperapp.Models=Paperapp.Models||{},function(){Paperapp.Models.UserModel=Backbone.Model.extend({initialize:function(){this.session},defaults:{username:"",session:void 0},validate:function(){},parse:function(a){return a},login:function(a,b,c){var d=this;$.ajax({url:APPCONF.URLS.LOGIN,type:"POST",dataType:"JSON",beforeSend:function(b){b.setRequestHeader("X-BAASBOX-APPCODE",APPCONF.BAAS_APP_CODE),b.setRequestHeader("Authentication","Basic "+Base64.encode(a.username+":"+a.password))},data:$.extend(a,{appcode:APPCONF.BAAS_APP_CODE}),success:function(e){e=JSON.parse(e),d.set("session",e.data["X-BB-SESSION"]),d.set("username",a.username),d.set("password",a.password),b||Paperapp.views.appView.popup("You have succesfully logged in","",!0),d.trigger("loginComplete",a),c&&c()},error:function(){c&&c(),Paperapp.views.appView.popup("Login error","",!1)}})},signup:function(a){var b=this;$.ajax({url:APPCONF.URLS.SIGNUP,type:"POST",dataType:"JSON",contentType:"application/json",beforeSend:function(b){b.setRequestHeader("X-BAASBOX-APPCODE",APPCONF.BAAS_APP_CODE),b.setRequestHeader("Authentication","Basic "+Base64.encode(a.username+":"+a.password))},data:JSON.stringify($.extend(a,{appcode:APPCONF.BAAS_APP_CODE})),success:function(){Paperapp.views.appView.popup("Signup successful","",!0),b.trigger("signupComplete",a)},error:function(a){a.responseText.length?Paperapp.views.appView.popup("Signup error",a.responseText,!1):Paperapp.views.appView.popup("Signup error","response is empty",!1)}})},logout:function(){var a=this;$.ajax({url:APPCONF.URLS.LOGOUT,type:"POST",beforeSend:function(b){b.setRequestHeader("X-BAASBOX-APPCODE",APPCONF.BAAS_APP_CODE),b.setRequestHeader("X-BB-SESSION",a.get("session"))},success:function(){a.set("session",""),a.set("username",""),a.set("password",""),a.trigger("loggedOut",[]),Paperapp.views.appView.popup("You have been logged out","",!0)},error:function(){}})},changepass:function(a){var b=this;$.ajax({url:APPCONF.URLS.CHANGEPASS,type:"POST",dataType:"JSON",contentType:"application/json",beforeSend:function(a){a.setRequestHeader("X-BAASBOX-APPCODE",APPCONF.BAAS_APP_CODE),a.setRequestHeader("X-BB-SESSION",b.get("session")),a.setRequestHeader("Authentication","Basic "+Base64.encode(b.get("username")+":"+b.get("password")))},data:JSON.stringify(a),success:function(){Paperapp.views.appView.popup("Your password changed","",!0),b.trigger("passwordUpdated",[])},error:function(a){Paperapp.views.appView.popup("Password change error",a.errorCode,!1)}})},resetpass:function(a){var b=APPCONF.URLS.RESETPASS.replace(":username",a.username);$.ajax({url:b,type:"GET",beforeSend:function(a){a.setRequestHeader("X-BAASBOX-APPCODE",APPCONF.BAAS_APP_CODE)},success:function(){Paperapp.views.appView.popup("Password reset request send, check your email.","",!0)},error:function(a){Paperapp.views.appView.popup("Password reset request error",a.responseText,!1)}})}})}(),Paperapp.Views=Paperapp.Views||{},function(){Paperapp.Views.AppView=Backbone.View.extend({el:"body",events:{"submit #signup-form":"signup","submit #login-form":"login","click #user-logout":"logout","submit #changepass-form":"changepass","submit #resetpass-form":"resetpass"},initialize:function(){var a=this;_.bindAll(this,"signup","login","logout","changepass","resetpass"),Paperapp.models.userModel=new Paperapp.Models.UserModel,Paperapp.views.settingsView=new Paperapp.Views.SettingsView,$.ui.backButtonText="Back",localStorage.getItem("_username")&&localStorage.getItem("_password")?Paperapp.models.userModel.login({username:localStorage.getItem("_username"),password:localStorage.getItem("_password")},!0,function(){window.setTimeout(function(){$.ui.launch()},100)}):(Paperapp.views.settingsView.render(),window.setTimeout(function(){$.ui.launch()},100)),$.ui.ready(function(){console.log("app framework launched"),$.ui.removeFooterMenu()}),Paperapp.models.userModel.on("signupComplete",function(a){Paperapp.models.userModel.login({username:a.username,password:a.password},!0)}),Paperapp.models.userModel.on("loginComplete",function(b){a.updateUserName(),localStorage.setItem("_username",b.username),localStorage.setItem("_password",b.password),Paperapp.views.settingsView.render()}),Paperapp.models.userModel.on("loggedOut",function(){localStorage.removeItem("_username"),localStorage.removeItem("_password"),a.updateUserName(),Paperapp.views.settingsView.render()})},signup:function(a){a.preventDefault();var b=$(a.currentTarget);Paperapp.models.userModel.signup(helpers.serializeFormToArray(b))},login:function(a){a.preventDefault();var b=$(a.currentTarget);Paperapp.models.userModel.login(helpers.serializeFormToArray(b))},logout:function(a){a.preventDefault(),Paperapp.models.userModel.logout()},changepass:function(a){a.preventDefault();var b=$(a.currentTarget);Paperapp.models.userModel.changepass(helpers.serializeFormToArray(b))},resetpass:function(a){a.preventDefault();var b=$(a.currentTarget);Paperapp.models.userModel.resetpass(helpers.serializeFormToArray(b))},updateUserName:function(){$("#main .username").text(Paperapp.models.userModel.get("username"))},popup:function(a,b,c){$.ui.popup({title:a,message:b,doneText:"ok",cancelText:"",doneCallback:function(){c&&$.ui.loadContent("#main")}})}})}(),Paperapp.Views=Paperapp.Views||{},function(){"use strict";Paperapp.Views.SettingsView=Backbone.View.extend({template:JST["app/scripts/templates/settings.hbs"],el:"#settings",initialize:function(){},render:function(){this.$el.html(this.template({loggedIn:Paperapp.models.userModel.get("session")?!0:!1}))}})}();